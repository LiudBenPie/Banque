-- Suppression des tables si elles existent déjà
DROP TABLE IF EXISTS rdv;
DROP TABLE IF EXISTS Motif;
DROP TABLE IF EXISTS Employe;
DROP TABLE IF EXISTS ContratClient;
DROP TABLE IF EXISTS Contrat;
DROP TABLE IF EXISTS Operation;
DROP TABLE IF EXISTS CompteClient;
DROP TABLE IF EXISTS Client;
DROP TABLE IF EXISTS Compte;
DROP TABLE IF EXISTS TypeCompte;

-- Création des tables
CREATE TABLE TypeCompte (
    idType INT PRIMARY KEY AUTO_INCREMENT,
    nomType VARCHAR(255),
    description VARCHAR(255)
);

CREATE TABLE Compte (
    idCompte INT PRIMARY KEY AUTO_INCREMENT,
    nomCompte VARCHAR(255),
    idType INT,
    FOREIGN KEY (idType) REFERENCES TypeCompte(idType)
);

CREATE TABLE Client (
    numClient INT PRIMARY KEY AUTO_INCREMENT,
    nom VARCHAR(255),
    prenom VARCHAR(255),
    adresse VARCHAR(255),
    mail VARCHAR(255),
    numTel VARCHAR(255),
    situation VARCHAR(255),
    dateNaissance DATE
);

CREATE TABLE CompteClient (
    dateOuverture DATE,
    solde DECIMAL(10, 2),
    montantDecouvert DECIMAL(10, 2),
    numClient INT,
    idCompte INT,
    PRIMARY KEY (numClient, idCompte),
    FOREIGN KEY (numClient) REFERENCES Client(numClient),
    FOREIGN KEY (idCompte) REFERENCES Compte(idCompte)
);

CREATE TABLE Operation (
    numOp INT PRIMARY KEY AUTO_INCREMENT,
    montant DECIMAL(10, 2),
    typeOp VARCHAR(255),
    idCompte INT,
    FOREIGN KEY (idCompte) REFERENCES Compte(idCompte)
);

CREATE TABLE Contrat (
    numContrat INT PRIMARY KEY AUTO_INCREMENT,
    nomContrat VARCHAR(25) 
);

CREATE TABLE ContratClient (
    idContratClient INT PRIMARY KEY AUTO_INCREMENT,
    dateOuvertureContrat DATE,
    tarifMensuel DECIMAL(10, 2),
    numClient INT,
    numContrat INT,
    FOREIGN KEY (numClient) REFERENCES Client(numClient),
    FOREIGN KEY (numContrat) REFERENCES Contrat(numContrat)
);

CREATE TABLE Employe (
    numEmploye INT PRIMARY KEY AUTO_INCREMENT,
    nom VARCHAR(255),
    login VARCHAR(255),
    motDePasse VARCHAR(255),
    categorie VARCHAR(255)
);

CREATE TABLE Motif (
    idMotif INT PRIMARY KEY AUTO_INCREMENT,
    libelleMotif VARCHAR(255),
    listePieces VARCHAR(255)
);

CREATE TABLE rdv (
    numRdv INT PRIMARY KEY AUTO_INCREMENT,
    dateRdv DATETIME NOT NULL,
    timeRdv INT,
    numEmploye INT,
    idMotif INT,
    FOREIGN KEY (numEmploye) REFERENCES Employe(numEmploye),
    FOREIGN KEY (idMotif) REFERENCES Motif(idMotif)
);

-- Insertion des données
INSERT INTO TypeCompte (idType, nomType, description) VALUES
(1, 'Compte Courant', 'Pour les opérations quotidiennes'),
(2, 'Livret A', 'Épargne réglementée avec un taux d’intérêt exonéré d’impôts'),
(3, 'PEL', 'Plan Épargne Logement pour un projet immobilier');

INSERT INTO Compte (idCompte, nomCompte, idType) VALUES
(101, 'CompteCourantDurand', 1),
(102, 'LivretAMoreau', 2),
(103, 'PELPetit', 3);

INSERT IGNORE INTO Client (numClient, nom, prenom, adresse, mail, numTel, situation, dateNaissance) VALUES
(201, 'Durand', 'Alice', '12 rue des Lilas', 'alice.durand@example.com', '0123456789', 'Célibataire', '1985-04-12'),
(202, 'Moreau', 'Bob', '45 avenue du Général', 'bob.moreau@example.net', '9876543210', 'Marié', '1978-08-23'),
(203, 'Petit', 'Clara', '78 boulevard de la Liberté', 'clara.petit@example.org', '5678901234', 'Divorcé', '1990-11-30');

INSERT INTO CompteClient (dateOuverture, solde, montantDecouvert, numClient, idCompte) VALUES
('2024-01-01', 1500.00, 200.00, 201, 101),
('2024-02-01', 3000.00, 0.00, 202, 102),
('2024-03-01', 6000.00, 500.00, 203, 103);

INSERT INTO Operation (montant, typeOp, idCompte) VALUES
(150.00, 'Dépôt', 101),
(200.00, 'Retrait', 102),
(400.00, 'Dépôt', 103);

INSERT INTO Contrat (nomContrat) VALUES
('ContratBasique'),
('ContratPremium'),
('ContratEntreprise');

INSERT INTO ContratClient (dateOuvertureContrat, tarifMensuel, numClient, numContrat) VALUES
('2024-04-01', 9.99, 201, 1),
('2024-05-01', 19.99, 202, 2),
('2024-06-01', 29.99, 203, 3);

INSERT INTO Employe (nom, login, motDePasse, categorie) VALUES
('Conseiller Y', 'Conseiller Y', '$2y$10$4ieMYxLS0BSGqTNQBwI.SOfFUG.VIQPq5cIjDQGg73Bbraw/9Cr1m', 'Conseiller'),
('Directeur', 'Directeur', '$2y$10$4ieMYxLS0BSGqTNQBwI.SOfFUG.VIQPq5cIjDQGg73Bbraw/9Cr1m', 'Directeur'),
('Agent', 'Agent', '$2y$10$4ieMYxLS0BSGqTNQBwI.SOfFUG.VIQPq5cIjDQGg73Bbraw/9Cr1m', 'Agent'),
('Conseiller X', 'Conseiller X', '$2y$10$4ieMYxLS0BSGqTNQBwI.SOfFUG.VIQPq5cIjDQGg73Bbraw/9Cr1m', 'Conseiller');

INSERT INTO Motif (libelleMotif, listePieces) VALUES
('compte type C', 'Pièce d’identité, Justificatif de domicile'),
('Demande de prêt', 'Avis d’imposition, Bulletins de salaire'),
('Clôture de compte', 'RIB, Lettre de clôture');
