-- Suppression des tables si elles existent déjà
DROP TABLE IF EXISTS rdv;
DROP TABLE IF EXISTS Motif;
DROP TABLE IF EXISTS Employe;
DROP TABLE IF EXISTS ContratClient;
DROP TABLE IF EXISTS Contrat;
DROP TABLE IF EXISTS Operation;
DROP TABLE IF EXISTS CompteClient;
DROP TABLE IF EXISTS Client;
DROP TABLE IF EXISTS Compte;
DROP TABLE IF EXISTS TypeCompte;
DROP TABLE IF EXISTS Situation;

-- Création des tables
CREATE TABLE Situation (
    idSituation INT PRIMARY KEY AUTO_INCREMENT,
    description VARCHAR(255) NOT NULL
);

CREATE TABLE Compte (
    idCompte INT PRIMARY KEY AUTO_INCREMENT,
    nomTypeCompte VARCHAR(255),
    description VARCHAR(255)
);

CREATE TABLE Client (
    numClient INT PRIMARY KEY AUTO_INCREMENT,
    nom VARCHAR(255),
    prenom VARCHAR(255),
    adresse VARCHAR(255),
    mail VARCHAR(255),
    numTel VARCHAR(255),
    dateNaissance DATE,
    idSituation INT,
    FOREIGN KEY (idSituation) REFERENCES Situation(idSituation)
);

CREATE TABLE CompteClient (
    idCompteClient INT PRIMARY KEY AUTO_INCREMENT,
    dateOuverture DATE,
    solde DECIMAL(10, 2),
    montantDecouvert DECIMAL(10, 2),
    numClient INT,
    idCompte INT,
    FOREIGN KEY (numClient) REFERENCES Client(numClient),
    FOREIGN KEY (idCompte) REFERENCES Compte(idCompte)
);

CREATE TABLE Operation (
    numOp INT PRIMARY KEY AUTO_INCREMENT,
    montant DECIMAL(10, 2),
    typeOp VARCHAR(255),
    idCompteClient INT,
    FOREIGN KEY (idCompteClient) REFERENCES CompteClient(idCompteClient)
);

CREATE TABLE Contrat (
    numContrat INT PRIMARY KEY AUTO_INCREMENT,
    nomTypeContrat VARCHAR(25),
    description VARCHAR(255) 
);

CREATE TABLE ContratClient (
    idContratClient INT PRIMARY KEY AUTO_INCREMENT,
    dateOuvertureContrat DATE,
    tarifMensuel DECIMAL(10, 2),
    numClient INT,
    numContrat INT,
    FOREIGN KEY (numClient) REFERENCES Client(numClient),
    FOREIGN KEY (numContrat) REFERENCES Contrat(numContrat) ON DELETE CASCADE
);

CREATE TABLE Employe (
    numEmploye INT PRIMARY KEY AUTO_INCREMENT,
    nom VARCHAR(255),
    login VARCHAR(255),
    motDePasse VARCHAR(255),
    categorie VARCHAR(255)
);

CREATE TABLE Motif (
    idMotif INT PRIMARY KEY AUTO_INCREMENT,
    libelleMotif VARCHAR(255),
    listePieces VARCHAR(255)
);

CREATE TABLE rdv (
    numRdv INT PRIMARY KEY AUTO_INCREMENT,
    dateRdv DATETIME NOT NULL,
    timeRdv INT,
    numEmploye INT,
    idMotif INT,
    FOREIGN KEY (numEmploye) REFERENCES Employe(numEmploye),
    FOREIGN KEY (idMotif) REFERENCES Motif(idMotif)
);

-- Insertion des données
INSERT INTO Situation (description) VALUES
('Marié(e)'),
('Célibataire'),
('Veuf/Veuve'),
('Divorcé(e)'),
('En couple'),
('En concubinage'),
('Séparé(e)'),
('Fiancé(e)'),
('Pacsé(e)'),
('En relation à distance');

INSERT INTO Compte (nomTypeCompte, description) VALUES
('Compte Courant', 'Pour les opérations quotidiennes'),
('Livret A', 'Épargne réglementée avec un taux d’intérêt exonéré d’impôts'),
('PEL', 'Plan Épargne Logement pour un projet immobilier');

INSERT IGNORE INTO Client (numClient, nom, prenom, adresse, mail, numTel, idSituation, dateNaissance) VALUES
(201, 'Durand', 'Alice', '12 rue des Lilas', 'alice.durand@example.com', '0123456789', 1, '1985-04-12'),
(202, 'Moreau', 'Bob', '45 avenue du Général', 'bob.moreau@example.net', '9876543210', 2, '1978-08-23'),
(203, 'Petit', 'Clara', '78 boulevard de la Liberté', 'clara.petit@example.org', '5678901234', 3, '1990-11-30');

INSERT INTO CompteClient (dateOuverture, solde, montantDecouvert, numClient, idCompteClient) VALUES
('2024-01-01', 1500.00, 200.00, 201, 101),
('2024-02-01', 3000.00, 0.00, 202, 102),
('2024-03-01', 6000.00, 500.00, 203, 103);

INSERT INTO Operation (montant, typeOp, idCompteClient) VALUES
(150.00, 'Dépôt', 101),
(200.00, 'Retrait', 102),
(400.00, 'Dépôt', 103);

INSERT INTO Contrat (nomTypeContrat, description) VALUES
('ContratBasique', 'C est un contrat basique'),
('ContratPremium','C est un contrat premium'),
('ContratEntreprise','C est un contrat Entreprise');

INSERT INTO ContratClient (dateOuvertureContrat, tarifMensuel, numClient, numContrat) VALUES
('2024-04-01', 9.99, 201, 1),
('2024-05-01', 19.99, 202, 2),
('2024-06-01', 29.99, 203, 3);

INSERT INTO Employe (nom, login, motDePasse, categorie) VALUES
('Conseiller Y', 'Conseiller Y', '$2y$10$4ieMYxLS0BSGqTNQBwI.SOfFUG.VIQPq5cIjDQGg73Bbraw/9Cr1m', 'Conseiller'),
('Directeur', 'Directeur', '$2y$10$4ieMYxLS0BSGqTNQBwI.SOfFUG.VIQPq5cIjDQGg73Bbraw/9Cr1m', 'Directeur'),
('Agent', 'Agent', '$2y$10$4ieMYxLS0BSGqTNQBwI.SOfFUG.VIQPq5cIjDQGg73Bbraw/9Cr1m', 'Agent'),
('Conseiller X', 'Conseiller X', '$2y$10$4ieMYxLS0BSGqTNQBwI.SOfFUG.VIQPq5cIjDQGg73Bbraw/9Cr1m', 'Conseiller');

INSERT INTO Motif (libelleMotif, listePieces) VALUES
('compte type C', 'Pièce d’identité, Justificatif de domicile'),
('Demande de prêt', 'Avis d’imposition, Bulletins de salaire'),
('Clôture de compte', 'RIB, Lettre de clôture');
